# Парсер html розміток з статей 

**Універсальний парсер, що витягує HTML-розмітку зі статей на вебсайтах. Основні можливості проекту:**

- **Витяг заголовків та контенту:** Програма може витягувати заголовки та основний текст зі статей на вебсторінках.
- **Налаштовувані параметри:** Пропонує можливість налаштування різних параметрів для оптимізації парсингу відповідно до специфічних потреб.
- **Інтерфейс:** Забезпечує налаштувальний інтерфейс для зручності користувача.

**Цей проект розроблений мною як новачком у програмуванні. Визнання своїх слабких сторін є частиною процесу навчання, тому можливо, що проект не є ідеальним.**



---

## Зміст

- [Вступ](#вступ)
- [Особливості](#особливості)
- [Встановлення](#встановлення)
- [Використання](#використання)
- [Конфігурація](#конфігурація)
- [Архітектура](#архітектура)
- [Опис файлів](#опис-файлів)
- [Тестування](#тестування)
- [Ліцензія](#ліцензія)
- [Автори](#автори)
- [Висновок](#висновок)


---

## Вступ
*Універсальний парсер розроблено для ефективного витягнення 
HTML розмітки з веб-сайтів, зокрема заголовків та контенту. 
Цей парсер має налаштовувані параметри для адаптації до
різних структур сайтів і може бути легко налаштований для специфічних потреб.*

---

## Особливості:

Перелік основних функцій та можливостей проєкту.

- **Особливість 1**: Можливість вибору способу аналізу сторінки.
- **Особливість 2**: Можливість працювати як з HTTP запитами.
- **Особливість 3**: Можливість завантажити сайт для підвантаження JS скриптів.
- **Особливість 4**: Підтримка асинхронного виконання програми, а також паралельного виконання.
- **Особливість 5**: Можливість завантажити інформацію у різних форматах: Excel, CSV, або ZIP з XML.
- **Особливість 6**: Інтерфейс, який запускається на локальній машині.
- **Особливість 7**: Можливість налаштувати роботу парсера через файл конфігурації для конкретної задачі.
- **Особливість 8**: Можливість парсити велику кількість сторінок одним запитом.

---


## Встановлення:

1. Клонуйте репозиторій:
    ```bash
    git clone https://github.com/0-EternalJunior-0/FastApiParser.git
    ```

2. Встановіть залежності з файлу `requirements.txt`:
    ```bash
    pip install -r requirements.txt
    ```

3. Запустіть файл `main.py` через інтегроване середовище розробки (IDE) або в консолі:
    ```bash
    python3 main.py
    ```

4. Для створення виконуваного файлу (.exe), запустіть скрипт `build_project.py`, який створить папку з білдом проєкту та сам .exe файл:
    ```bash
    python3 build_project.py
    ```

## Використання
Після встановлення всіх бібліотек і запуску виконуваного файлу .exe або скрипта main.py, 
запускається локальний сервіс. Якщо код виконався без помилок, відкрийте в 
браузері адресу `http://127.0.0.1:8000/`, де буде запущений сам проєкт.

На головному екрані проєкту виберіть стартові налаштування:

- **Ядро проєкту** – компонент, який буде діставати дані.
- **Аналізатор** – компонент, який буде аналізувати контент.

Після вибору налаштувань натисніть кнопку "Submit" і зачекайте, поки всі скрипти виконаються. Після завершення з'явиться можливість:

- Переглянути дані у вигляді таблиці ("Переглянути таблицю").
- Завантажити ці дані для подальшого використання.

Налаштування самого аналізатора доступні у файлі `config.yaml.` Він містить достатню кількість параметрів для того, щоб пристосувати парсер під будь-яку задачу.

---

## Конфігурація

У директорії проєкту є файл `config.yaml`, який використовується для налаштування парсера. Ось короткий опис кожного параметра:

* `ignore_words`

Список слів, при зустрічанні яких парсер припиняє подальше сканування сайту. Якщо одне з цих слів знайдене в текстовому вмісті блоку, блок буде ігноровано, і парсер припинить подальшу обробку цього блоку.


* `tags_to_remove`

Список тегів, які будуть видалені, але їх вміст залишиться. Наприклад, тег <span> буде видалено, але текст всередині нього залишиться.


* `tags_to_del`

Список тегів, які будуть повністю видалені разом з їх вмістом. Наприклад, тег <head> буде видалено разом з метаданими і стилями всередині.



* `remove_style_attributes`

Визначає, чи слід видаляти стилі з тегів. Якщо значення встановлено в 1, стилі будуть видалені з тегів. Якщо 0, стилі залишаться.


* `timeout_time`

Таймаут: час у секундах, протягом якого парсер чекає відповідь від сервера.


* `image_src_attributes`

Атрибути тегів \<img>, які використовуються для отримання URL зображень. Використовується для заміни відносних URL на абсолютні, враховуючи різні атрибути, які можуть бути присутні на сайті.


* `attributes_to_remove`

Список атрибутів, які будуть видалені з тегів, таких як class, id, style тощо.


* `cleaned_data_save`

Якщо значення відмінне від 0, дані будуть очищені перед збереженням.


* `cleaned_data_table_view`

Якщо значення відмінне від 0, дані будуть очищені перед відображенням у таблиці.


* `now_base_url_image`

Базовий URL для зображень. Якщо параметр пустий, використовуються URL сайту.


* `host та port`

IP-адреса та порт для локального сервера, на якому запускається проєкт.

---

## Архітектура

Проєкт має наступну структуру директорій і файлів, кожен з яких виконує певну роль:

### Основні файли та директорії:

- **`app.py`**: Основний файл, який містить реалізацію FastAPI для запуску локального сервісу. Тут конфігурується і запускається сервер.

- **`build_proect.py`**: Скрипт для створення виконуваного файлу (.exe) з проєкту. Залежності та параметри для збірки вказані в цьому файлі.

- **`config_chrome_options.py`**: Конфігураційний файл для налаштування опцій Chrome при використанні Selenium. Містить параметри для запуску браузера в режимі без головного вікна, налаштування User-Agent та інші.

- **`config.yaml`**: Файл конфігурації парсера. Налаштовує параметри, такі як ігнорування певних слів, видалення тегів і атрибутів, таймаут для запитів, тощо.

- **`data_processing.py`**: Модуль для обробки даних, отриманих з парсера. Містить функції для очистки і форматування даних перед збереженням.

- **`main.py`**: Основний скрипт для запуску парсера. Може бути використаний як точка входу для запуску програми.

- **`myapp.spec`**: Файл конфігурації для PyInstaller, який визначає параметри для створення виконуваного файлу.

- **`parser.log`**: Лог-файл, в якому записуються повідомлення про помилки та інформація про виконання парсера.

- **`parser.py`**: Основний модуль парсера. Містить реалізацію функцій для парсингу HTML і обробки контенту.

- **`README.md`**: Документація проєкту. Містить інформацію про встановлення, використання та конфігурацію.

- **`requirements.txt`**: Файл з переліком залежностей проєкту, які необхідно встановити.

- **`static`**: Директорія для статичних файлів, Які приілтають підчас робот програми.

- **`templates`**: Директорія для шаблонів HTML, які використовуються FastAPI для рендерингу веб-сторінок.

- **`tests`**: Директорія для тестів, які перевіряють функціональність проєкту.

- **`utils.py`**: Модуль утиліт, що містить допоміжні функції та класи, які використовуються в інших частинах проєкту.
- 
- **`templates`**: Директорія для шаблонів HTML, які використовуються FastAPI для рендерингу веб-сторінок. Містить:
  - **`index.html`**: Головна HTML-сторінка проєкту.
  - **`parsed_result.html`**: Шаблон для відображення результатів парсингу.
  - **`static`**: Піддиректорія для статичних файлів, використовуваних шаблонами.
  - **`table_view.html`**: Шаблон для відображення даних у вигляді таблиці.
### Взаємодія компонентів:

1. **Парсер** (`parser.py`): Отримує HTML-контент з веб-сторінок і 
обробляє його відповідно до конфігураційних налаштувань. 
При використанні Selenium для завантаження динамічного контенту, 
парсер також використовує модуль `data_processing.py` для налаштування 
самого браузера. У режимі HTTP (без Selenium) парсер працює з дефолтними 
налаштуваннями для отримання контенту.


2. **Конфігурація** (`config.yaml` та `config_chrome_options.py`): Налаштовує поведінку парсера і браузера. Задає параметри для роботи парсера та Selenium.


3. **Веб-сервер** (`app.py`): Запускає локальний сервер за допомогою FastAPI. Обробляє запити на отримання і відображення даних.


4. **Виконуваний файл** (`build_proect.py`): Використовується для створення самостійного виконуваного файлу (.exe), який може бути розгорнутий на іншій машині без необхідності інсталяції Python.


5. **Тести** (`tests/`): Просто папка для кодів як тестуються під час розробки.


**Примітка:** Архітектура проєкту може бути вдосконалена в майбутньому для підвищення ефективності та зручності використання.

---

## Опис файлів

### Опис файлу `app.py`

Файл `app.py` реалізує веб-застосунок на основі FastAPI, що забезпечує функціональність для парсингу URL, відображення таблиць та завантаження файлів.

### *Імпортовані бібліотеки*

- **Стандартні бібліотеки**:
  - `asyncio`: для асинхронного програмування.
  - `os`: для роботи з файловою системою.
  - `random`: для генерації випадкових чисел.
  - `logging`: для ведення журналу.

- **FastAPI компоненти**:
  - `FastAPI`: основний клас для створення веб-застосунку.
  - `Request`, `HTMLResponse`, `FileResponse`: для обробки запитів і відповідей.
  - `Jinja2Templates`: для рендерингу HTML шаблонів.
  - `StaticFiles`: для обробки статичних файлів.

- **Інші бібліотеки**:
  - `pandas`: для обробки даних.

### *Налаштування*

- **Статичні файли**: Директорії `templates` для HTML шаблонів та `static` для статичних файлів.
- **Логування**: Логи зберігаються у файлі `parser.log`.
- **Конфігурація**: Завантажується з `config.yaml`.

### *Роутери*

- **Головна сторінка (`/`)**: Відображає шаблон `index.html`.
- **Парсинг URL (`/parse`)**: Приймає одиночний URL або список URL для парсингу.
- **Відображення таблиці (`/table`)**: Показує таблицю з парсингованими даними.
- **Завантаження файлів (`/download`)**: Завантажує файли у форматах `xlsx`, `csv`, або `xml`.

### *Запуск*

Щоб запустити застосунок, використовуйте `uvicorn`:

```bash
uvicorn app:app --host 127.0.0.1 --port 8000
```

### Опис файлу `build_proect.py`

Цей модуль відповідає за створення виконуваного файлу з Python скрипту за допомогою PyInstaller.

### *Імпортовані бібліотеки*

- **`subprocess`**: Для виконання команд оболонки в Python.

###  *Команди для створення виконуваного файлу *

1. **`pip install pyinstaller`**
   - **Опис**: Встановлює PyInstaller, якщо він ще не встановлений. PyInstaller необхідний для перетворення Python скриптів у самостійні виконувані файли.

2. **`pyinstaller --onefile myapp.spec`**
   - **Опис**: Створює виконуваний файл з Python скрипту на основі конфігурації, зазначеної у файлі `myapp.spec`.
   - **`--onefile`**: Вказує PyInstaller створювати один єдиний виконуваний файл, що спрощує розгортання і розподіл.

### *Приклад використання*

1. Запустіть модуль Python для встановлення PyInstaller.
2. Після успішного встановлення PyInstaller, створіть виконуваний файл з Python скрипту за допомогою конфігураційного файлу `myapp.spec`.

**Зверніть увагу**, що перед виконанням цих команд, переконайтесь, що у вас є доступ до Python середовища та налаштованого файлу конфігурації `myapp.spec`.




### Опис файлу `config_chrome_options.py`

Цей модуль містить конфігурацію для налаштування параметрів браузера Chrome за допомогою Selenium WebDriver.

###  *Імпортовані бібліотеки*

- **`Options`** з `selenium.webdriver.chrome.options`: Для налаштування опцій браузера Chrome.

### *Функції*

### `chrome_options()`

- **Опис**: Налаштовує параметри для браузера Chrome.

- **Основні налаштування**:
  - **`--disable-gpu`**: Вимикає апаратне прискорення графіки.
  - **`--no-sandbox`**: Вимикає пісочницю, яка забезпечує безпеку браузера.
  - **`--disable-dev-shm-usage`**: Вимикає використання спільної пам'яті для запобігання помилкам в контейнерах.
  - **`--disable-extensions`**: Вимикає розширення браузера.
  - **`--disable-popup-blocking`**: Вимикає блокування спливаючих вікон.
  - **`user-agent`**: Встановлює спеціальний User-Agent для браузера.

- **Налаштування проксі**: Можна додати опцію для проксі, якщо необхідно (`--proxy-server=http://your-proxy:port`).

- **Прихований режим**: Опція `--headless` закоментована. Можна розкоментувати, щоб запустити браузер в прихованому режимі.

### `setup_browser()`

- **Опис**: Налаштовує браузер Chrome з параметрами, визначеними у `chrome_options()`. Містить приклад налаштування куків.

- **Зміст**:
  - Викликає `chrome_options()` для отримання налаштувань браузера.
  - Включає приклад налаштування куків.

## *Використання*

1. Імплементуйте функцію `setup_browser()` для налаштування браузера за потребою.
2. Використовуйте налаштування, що повертаються функцією `chrome_options()`, при створенні екземпляра браузера Chrome через Selenium.

**Зверніть увагу**: Налаштування проксі та прихований режим закоментовані, але їх можна розкоментувати в разі необхідності.




###  Опис файлу `main.py`

Цей модуль відповідає за запуск веб-застосунку на базі FastAPI і забезпечує обробку файлів у директорії `static`.

### *Імпортовані бібліотеки*

- **`os`**: Для роботи з операційною системою, зокрема для роботи з файлами та директоріями.
- **`glob`**: Для знаходження шляхів до файлів за заданим шаблоном.
- **`uvicorn`**: Для запуску ASGI сервера.
- **`app`** з `app.py`: Основний FastAPI додаток.
- **`load_config`** з `utils.py`: Для завантаження конфігураційного файлу.

### *Функції*

### `static_clir()`

- **Опис**: Перевіряє наявність директорії `static` і видаляє старі файли, залишаючи 50 найновіших.

- **Процес**:
  1. Перевіряє існування директорії `static`.
  2. Отримує список всіх файлів у директорії та сортує їх за датою зміни.
  3. Видаляє файли, які не входять до 50 найновіших, і повідомляє про видалення.

- **Обробка помилок**: Виводить повідомлення про помилку, якщо файл не вдалося видалити.

### `main()`

- **Опис**: Запускає сервер за допомогою `uvicorn` і викликає функцію `static_clir()` для обробки файлів у директорії `static`.

- **Процес**:
  1. Викликає функцію `static_clir()` для обробки старих файлів.
  2. Запускає сервер `uvicorn` на основі конфігурацій, завантажених з файлу `config.yaml`.
  3. Виводить повідомлення про успішний запуск сервера і інструкцію для відкриття веб-додатка в браузері.
  4. Обробляє помилки при запуску сервера і виводить повідомлення про них.

- **Обробка помилок**: Виводить повідомлення про помилку при запуску сервера або інших виключеннях.

### *Використання*

1. Переконайтесь, що конфігураційний файл `config.yaml` існує і містить правильні налаштування.
2. Запустіть цей скрипт, щоб почати обробку файлів у директорії `static` і запустити сервер.
3. Відкрийте браузер і перейдіть за адресою `http://127.0.0.1:8000/`, щоб побачити працюючий веб-додаток.

**Зверніть увагу**: Налаштування для хосту та порту серверу можна змінити в конфігураційному файлі `config.yaml`.

## Опис файлу `parser.py`

Цей модуль відповідає за парсинг веб-сторінок за допомогою різних методів (HTTP запити, Selenium) та обробку отриманого HTML контенту.

### *Імпортовані бібліотеки*

- **`concurrent.futures`**: Для асинхронного виконання завдань.
- **`time`**: Для роботи з часом, зокрема для затримок.
- **`typing.List`**: Для типізації списків.
- **`logging`**: Для ведення журналу подій.
- **`urllib.parse`**: Для обробки URL.
- **`aiohttp`**: Для асинхронних HTTP запитів.
- **`bs4`**: Для парсингу HTML за допомогою BeautifulSoup.
- **`selenium`**: Для автоматизації браузера.
- **`webdriver_manager`**: Для управління драйверами браузера.
- **`asyncio`**: Для асинхронного програмування.
- **`readability`**: Для очищення HTML контенту.
- **`data_processing`**: Для обробки HTML (функції для видалення небажаних тегів та атрибутів).
- **`utils`**: Для завантаження конфігурації та отримання опису статусу.
- **`config_chrome_options`**: Для налаштування параметрів Chrome браузера.

### *Функції*

`Https_Parser(url: str) -> str`

- **Опис**: Асинхронно виконує HTTP запит до заданого URL і повертає HTML контент.

- **Процес**:
  1. Встановлює заголовки запиту.
  2. Виконує HTTP GET запит з таймаутом.
  3. Логірує статус відповіді та помилки.

- **Обробка помилок**: Логірує помилки, якщо запит не вдався або виникла помилка під час обробки.

 `Selenium_Parser(url: str) -> str`

- **Опис**: Використовує Selenium для завантаження та прокрутки веб-сторінки, а потім повертає HTML контент.

- **Процес**:
  1. Налаштовує та запускає Chrome браузер за допомогою Selenium.
  2. Завантажує сторінку і прокручує її.
  3. Отримує та повертає HTML код сторінки.

- **Обробка помилок**: Логірує помилки, якщо завантаження сторінки не вдалося.

 `process_url_with_selenium(url: str) -> str`

- **Опис**: Обробляє URL за допомогою Selenium та повертає HTML контент.

- **Процес**: Викликає функцію `Selenium_Parser` у фоновому режимі за допомогою `ThreadPoolExecutor`.

- **Обробка помилок**: Логірує помилки, якщо виникають проблеми з обробкою через Selenium.

 `extract_content(url: str, ignore_list: List[str], code_v: str='0', parser_type='parser_type')`

- **Опис**: Витягує та обробляє контент з вказаного URL на основі вказаного типу парсера (`https` або `Selenium`).

- **Процес**:
  1. Використовує відповідний парсер для отримання HTML контенту.
  2. Обробляє HTML контент за допомогою BeautifulSoup.
  3. Очищає та обробляє HTML, видаляє небажані теги та атрибути.
  4. Замінює URL зображень і збирає інформацію про них.

- **Обробка помилок**: Логірує помилки при обробці URL або HTML контенту.

 `parse_sibling_elements_after_h1(title_tag: BeautifulSoup, ignore_list: List[str])`

- **Опис**: Обробляє всі сусідні елементи після тега `<h1>` на тому ж рівні вкладеності.

- **Процес**: Збирає та повертає HTML код сусідніх елементів.

 `parse_all_elements_after_h1(soup: BeautifulSoup, ignore_list: List[str])`

- **Опис**: Обробляє всі елементи після тега `<h1>`, включаючи вкладені елементи.

- **Процес**: Збирає та повертає HTML код всіх елементів після тега `<h1>`.

 `parse_readability(html: BeautifulSoup, ignore_list: List[str])`

- **Опис**: Використовує `readability` для очищення HTML контенту та додавання зображень.

- **Процес**:
  1. Використовує `readability` для отримання очищеного HTML.
  2. Збирає та додає зображення до очищеного контенту.
  3. Повертає фінальний HTML.

- **Обробка помилок**: Логірує помилки при обробці HTML контенту.

### Використання

1. Переконайтесь, що файл конфігурації `config.yaml` налаштований правильно.
2. Використовуйте функцію `extract_content` для витягування та обробки контенту з URL, вказуючи потрібний тип парсера та параметри.
3. Логування результатів і помилок здійснюється у файлі `parser.log`.


## utils.py

Цей модуль містить утиліти для роботи з конфігураційними файлами, HTTP статусами, перетворенням HTML в XML та створенням ZIP архівів.

Функції
-------

**load_config(config_file: str) -> dict**

Завантажує конфігурацію з YAML файлу.

- **Параметри:**
  - `config_file` (str): Шлях до YAML файлу конфігурації.
- **Повертає:**
  - dict: Словник з конфігураційними налаштуваннями.
- **Викидає:**
  - FileNotFoundError: Якщо файл не знайдено.

**get_status_description(status_code: int) -> str**

Повертає опис статус-коду HTTP.

- **Параметри:**
  - `status_code` (int): Код HTTP статусу.
- **Повертає:**
  - str: Опис статусу у форматі "Код відповіді: <код> - <опис>".

**html_to_xml(html_content: BeautifulSoup) -> str**

Перетворює HTML в XML формат.

- **Параметри:**
  - `html_content` (BeautifulSoup): HTML контент у вигляді BeautifulSoup об'єкта.
- **Повертає:**
  - str: XML представлення HTML контенту.
- **Опис:**
  Перетворює HTML-контент у формат XML. Якщо виникає помилка або результат порожній, зберігає HTML-контент як XML.

**create_zip_archive(files: list, zip_file_path: str)**

Створює ZIP архів з файлів.

- **Параметри:**
  - `files` (list): Список шляхів до файлів, які потрібно включити в архів.
  - `zip_file_path` (str): Шлях до створюваного ZIP архіву.
- **Викидає:**
  - FileNotFoundError: Якщо якийсь з файлів не знайдено.


<hr>

## Тести
У цьому проекті наразі відсутні автоматизовані юніт-тести або будь-які інші типи тестів,
що може впливати на стабільність і точність коду. Без належного тестування код може містити
помилки та неточності, які можуть призвести до неочікуваних результатів. Це особливо важливо 
враховувати при використанні ядра Selenium.

Зокрема, в процесі використання Selenium можуть виникати ситуації, 
коли запускається декілька десятків браузерів одночасно. Таке навантаження може перевищити
можливості системи, що призведе до збоїв або зниження продуктивності.
Хоча один з таких випадків вже був виправлений, відсутність тестів підвищує ризик
повторення подібних проблем у майбутньому.

<hr>

## Ліцензія

Цей проект є вільним для використання. Ви можете вільно використовувати, модифікувати і розповсюджувати цей проект за вашим бажанням. Я буду радий, якщо моя робота стане корисною для вас!

Будь ласка, звертайтеся, якщо у вас є питання або пропозиції щодо використання проекту. 

<hr>

## Автор

Жомирук Ярослав Валентинович  
Email: [zhomyruk.yaroslav.v@gmail.com](mailto:zhomyruk.yaroslav.v@gmail.com)
<hr>

## Висновок


Коли вам пропонують реалізацію проекту за низьку вартість і стислий термін, краще відмовитися. Мій код був написаний за кілька днів у вільний час, використовуючи технології, які були мало відомі. Тому він може мати недоліки та не відповідати всім стандартам якості.


Проте, якщо цей код все ж стане вам у пригоді, я буду радий, що моя робота принесла користь. В будь-якому випадку, рекомендую ретельно перевіряти і тестувати проект перед використанням.